<!DOCTYPE html>
<html>
<head>
  <title>Lakshmi Motor Cycle Spares</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body style="font-family: Arial; padding: 20px; background:#f4f4f4;">

<!-- ================= SHOP BRANDING ================= -->
<div style="text-align:center;padding:15px;margin-bottom:15px;background:#fff;border-radius:8px;">
  <h1 style="margin:0;font-size:22px;">üèçÔ∏è LAKSHMI MOTOR CYCLE SPARES</h1>
  <p style="margin:5px 0;color:#555;">Genuine 2-Wheeler Spare Parts</p>
  <p style="margin:5px 0;color:#777;">üöö Fast Delivery ‚Ä¢ üíØ Trusted Store</p>
</div>

<h3>üõµ Select Your Bike</h3>

<label>Brand</label>
<select id="brandSelect" style="width:100%;padding:10px;"></select><br><br>

<label>Model</label>
<select id="modelSelect" style="width:100%;padding:10px;"></select><br><br>

<label>Year</label>
<select id="yearSelect" style="width:100%;padding:10px;"></select><br><br>

<h3>Category</h3>
<div id="categories"></div>

<h3>Available Parts</h3>
<div id="parts"></div>

<script>
/* ================= CONFIG ================= */

/**
 * Telegram User ID
 * Always available inside Telegram WebApp
 */
const telegramUserId =
  window.Telegram &&
  Telegram.WebApp &&
  Telegram.WebApp.initDataUnsafe &&
  Telegram.WebApp.initDataUnsafe.user
    ? Telegram.WebApp.initDataUnsafe.user.id
    : null;

/**
 * Supabase Configuration
 * (UNCHANGED from your original file)
 */
const SUPABASE_URL = "https://gmajjousigloyiablmeo.supabase.co";
const SUPABASE_KEY = "sb_publishable_anzjPC7WhQVAzPP1JSAm4g_W-G90zZY";

/**
 * Google Maps Key (used later)
 * Keep empty for now
 */
const GOOGLE_MAPS_API_KEY = "";

/* ================= CORE LOGGING (app_logs) ================= */

/**
 * Low-level logger
 * NEVER throws
 * NEVER blocks UI
 */
async function logEvent({
  telegram_user_id,
  order_id = null,
  log_type = "INFO",
  source = "frontend",
  message,
  details = {}
}) {
  try {
    await fetch(`${SUPABASE_URL}/rest/v1/app_logs`, {
      method: "POST",
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        telegram_user_id,
        order_id,
        log_type,
        source,
        message,
        details
      })
    });
  } catch (e) {
    // ‚ùó Logging must NEVER break app flow
    console.warn("Logging failed", e);
  }
}

/**
 * High-level step logger
 * Standardizes STARTED / COMPLETED / FAILED
 */
async function logStep(
  step,
  status,
  details = {},
  order_id = null,
  source = "frontend"
) {
  await logEvent({
    telegram_user_id: telegramUserId,
    order_id,
    log_type: status === "FAILED" ? "ERROR" : "INFO",
    source,
    message: `${step} :: ${status}`,
    details
  });
}

/* ================= SAFE GUARD ================= */
/**
 * If telegramUserId is missing, log once.
 * Do NOT block app.
 */
if (!telegramUserId) {
  console.warn("Telegram user ID not available");
  logEvent({
    telegram_user_id: null,
    log_type: "WARNING",
    source: "frontend",
    message: "Telegram user ID missing",
    details: {
      note: "App opened outside Telegram or initDataUnsafe unavailable"
    }
  });
}
</script>

  
<!-- ================= IMAGE MODAL ================= -->
<div id="imageModal" style="
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.85);
  z-index:9999;
  justify-content:center;
  align-items:center;
  flex-direction:column;
">

  <img id="modalImage" style="
    max-width:90%;
    max-height:70%;
    border-radius:8px;
    background:#fff;
    padding:10px;
  ">

  <p id="modalPrice" style="
    color:#fff;
    font-size:18px;
    margin-top:10px;
  "></p>

  <div id="colorVariants" style="
    margin-top:15px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:center;
  "></div>

  <button onclick="closeModal()" style="
    margin-top:20px;
    padding:10px 20px;
    font-size:16px;
  ">
    ‚ùå Close
  </button>
</div>
